CCS PCH C Compiler, Version 4.140, 21898               27-jul-13 11:57

               Filename:   E:\Eletronica\Projetos\Calendario\calendario.lst

               ROM used:   2790 bytes (9%)
                           Largest free fragment is 29978
               RAM used:   25 (2%) at main() level
                           40 (3%) worst case
               Stack:     5 locations

*
0000:  GOTO   0896
.................... ///* 
.................... // * calendario.c 
.................... // * 
.................... // *  Created on: 02/02/2012 
.................... // *      Author: cuki 
.................... // */ 
....................  
.................... #include<18F452.h> 
.................... //////// Standard Header file for the PIC18F452 device //////////////// 
.................... #device PIC18F452 
.................... #list 
....................  
....................  
.................... #fuses H4 
.................... #use delay (crystal=10MHz, clock=40MHz) 
*
02EE:  CLRF   FEA
02F0:  MOVLW  23
02F2:  MOVWF  FE9
02F4:  MOVF   FEF,W
02F6:  BZ    0314
02F8:  MOVLW  0C
02FA:  MOVWF  01
02FC:  CLRF   00
02FE:  DECFSZ 00,F
0300:  BRA    02FE
0302:  DECFSZ 01,F
0304:  BRA    02FC
0306:  MOVLW  F7
0308:  MOVWF  00
030A:  DECFSZ 00,F
030C:  BRA    030A
030E:  BRA    0310
0310:  DECFSZ FEF,F
0312:  BRA    02F8
0314:  RETURN 0
*
0350:  MOVLW  02
0352:  SUBWF  23,F
0354:  BNC   036C
0356:  CLRF   FEA
0358:  MOVLW  23
035A:  MOVWF  FE9
035C:  MOVF   FEF,W
035E:  BZ    036C
0360:  MOVLW  02
0362:  MOVWF  00
0364:  DECFSZ 00,F
0366:  BRA    0364
0368:  DECFSZ FEF,F
036A:  BRA    0360
036C:  GOTO   0386 (RETURN)
.................... #use rs232(baud=9600,xmit=PIN_C6,rcv=PIN_C7) 
.................... #use i2c(master, sda=PIN_C4, scl=PIN_C3, fast=50000) 
*
0120:  MOVLW  08
0122:  MOVWF  01
0124:  MOVLW  1E
0126:  MOVWF  00
0128:  DECFSZ 00,F
012A:  BRA    0128
012C:  BCF    F8B.3
012E:  BCF    F94.3
0130:  MOVLW  1F
0132:  MOVWF  00
0134:  DECFSZ 00,F
0136:  BRA    0134
0138:  RLCF   1B,F
013A:  BCF    F8B.4
013C:  BTFSC  FD8.0
013E:  BSF    F94.4
0140:  BTFSS  FD8.0
0142:  BCF    F94.4
0144:  BSF    F94.3
0146:  BTFSS  F82.3
0148:  BRA    0146
014A:  DECFSZ 01,F
014C:  BRA    0124
014E:  MOVLW  1E
0150:  MOVWF  00
0152:  DECFSZ 00,F
0154:  BRA    0152
0156:  BCF    F8B.3
0158:  BCF    F94.3
015A:  NOP   
015C:  BSF    F94.4
015E:  MOVLW  1F
0160:  MOVWF  00
0162:  DECFSZ 00,F
0164:  BRA    0162
0166:  MOVLW  1F
0168:  MOVWF  00
016A:  DECFSZ 00,F
016C:  BRA    016A
016E:  BSF    F94.3
0170:  BTFSS  F82.3
0172:  BRA    0170
0174:  CLRF   01
0176:  MOVLW  1F
0178:  MOVWF  00
017A:  DECFSZ 00,F
017C:  BRA    017A
017E:  BTFSC  F82.4
0180:  BSF    01.0
0182:  BCF    F8B.3
0184:  BCF    F94.3
0186:  BCF    F8B.4
0188:  BCF    F94.4
018A:  RETURN 0
018C:  MOVLW  08
018E:  MOVWF  1D
0190:  MOVFF  00,1E
0194:  BSF    F94.4
0196:  MOVLW  1F
0198:  MOVWF  00
019A:  DECFSZ 00,F
019C:  BRA    019A
019E:  BSF    F94.3
01A0:  BTFSS  F82.3
01A2:  BRA    01A0
01A4:  BTFSC  F82.4
01A6:  BSF    FD8.0
01A8:  BTFSS  F82.4
01AA:  BCF    FD8.0
01AC:  RLCF   01,F
01AE:  MOVLW  1E
01B0:  MOVWF  00
01B2:  DECFSZ 00,F
01B4:  BRA    01B2
01B6:  BCF    F94.3
01B8:  BCF    F8B.3
01BA:  DECFSZ 1D,F
01BC:  BRA    0194
01BE:  BSF    F94.4
01C0:  MOVLW  1F
01C2:  MOVWF  00
01C4:  DECFSZ 00,F
01C6:  BRA    01C4
01C8:  BCF    F8B.4
01CA:  MOVF   1E,W
01CC:  BTFSS  FD8.2
01CE:  BCF    F94.4
01D0:  NOP   
01D2:  BSF    F94.3
01D4:  BTFSS  F82.3
01D6:  BRA    01D4
01D8:  MOVLW  1E
01DA:  MOVWF  00
01DC:  DECFSZ 00,F
01DE:  BRA    01DC
01E0:  BCF    F8B.3
01E2:  BCF    F94.3
01E4:  MOVLW  1F
01E6:  MOVWF  00
01E8:  DECFSZ 00,F
01EA:  BRA    01E8
01EC:  BCF    F8B.4
01EE:  BCF    F94.4
01F0:  RETURN 0
....................  
.................... #include"calendario.h" 
.................... /* 
....................  * calendario.h 
....................  * 
....................  *  Created on: 26/07/2013 
....................  *      Author: cuki 
....................  */ 
....................  
.................... #ifndef CALENDARIO_H_ 
.................... #define CALENDARIO_H_ 
....................  
.................... #define DS1307		0xD0 
.................... #define sec_addr	0x00 
.................... #define min_addr	0x01 
.................... #define hour_addr	0x02 
.................... #define day_addr	0x03 
.................... #define date_addr	0x04 
.................... #define month_addr	0x05 
.................... #define year_addr	0x06 
.................... #define ctlr_addr	0x07 
.................... #define debounce 	100 
....................  
.................... enum dow { 
.................... 	dom, seg, ter, qua, qui, sex, sab 
.................... }; 
....................  
.................... struct cal { 
.................... 	short am_pm, _12h; 
.................... 	int segundos, minutos, horas, dow, dia, mes, ano; 
.................... }; 
....................  
.................... int decToBcd(int val) { 
.................... 	return ((val / 10 * 16) + (val % 10)); 
.................... } 
....................  
.................... int bcdToDec(int val) { 
.................... 	return ((val / 16 * 10) + (val % 16)); 
*
0494:  SWAPF  1D,W
0496:  MOVWF  00
0498:  MOVLW  0F
049A:  ANDWF  00,F
049C:  MOVF   00,W
049E:  MULLW  0A
04A0:  MOVFF  FF3,1E
04A4:  MOVF   1D,W
04A6:  ANDLW  0F
04A8:  ADDWF  1E,W
04AA:  MOVWF  01
.................... } 
04AC:  GOTO   0648 (RETURN)
....................  
.................... int getReg(int addr) { 
.................... 	int leitura; 
....................  
.................... 	i2c_start(); 
*
01F2:  BSF    F94.4
01F4:  MOVLW  1E
01F6:  MOVWF  00
01F8:  DECFSZ 00,F
01FA:  BRA    01F8
01FC:  BSF    F94.3
01FE:  MOVLW  1F
0200:  MOVWF  00
0202:  DECFSZ 00,F
0204:  BRA    0202
0206:  BCF    F8B.4
0208:  BCF    F94.4
020A:  MOVLW  1E
020C:  MOVWF  00
020E:  DECFSZ 00,F
0210:  BRA    020E
0212:  BCF    F8B.3
0214:  BCF    F94.3
.................... 	i2c_write(DS1307); 
0216:  MOVLW  D0
0218:  MOVWF  1B
021A:  RCALL  0120
.................... 	i2c_write(addr); 
021C:  MOVFF  18,1B
0220:  RCALL  0120
.................... 	i2c_start(); 
0222:  BSF    F94.4
0224:  MOVLW  1E
0226:  MOVWF  00
0228:  DECFSZ 00,F
022A:  BRA    0228
022C:  BSF    F94.3
022E:  MOVLW  1F
0230:  MOVWF  00
0232:  DECFSZ 00,F
0234:  BRA    0232
0236:  BTFSS  F82.3
0238:  BRA    0236
023A:  BCF    F8B.4
023C:  BCF    F94.4
023E:  MOVLW  1E
0240:  MOVWF  00
0242:  DECFSZ 00,F
0244:  BRA    0242
0246:  BCF    F8B.3
0248:  BCF    F94.3
.................... 	i2c_write(DS1307 + 1); 
024A:  MOVLW  D1
024C:  MOVWF  1B
024E:  RCALL  0120
.................... 	leitura = i2c_read(0); 
0250:  CLRF   00
0252:  RCALL  018C
0254:  MOVFF  01,19
.................... 	i2c_stop(); 
0258:  BCF    F94.4
025A:  NOP   
025C:  BSF    F94.3
025E:  BTFSS  F82.3
0260:  BRA    025E
0262:  MOVLW  1E
0264:  MOVWF  00
0266:  DECFSZ 00,F
0268:  BRA    0266
026A:  BRA    026C
026C:  NOP   
026E:  BSF    F94.4
0270:  MOVLW  1E
0272:  MOVWF  00
0274:  DECFSZ 00,F
0276:  BRA    0274
....................  
.................... 	return leitura; 
0278:  MOVFF  19,01
.................... } 
027C:  GOTO   02DE (RETURN)
....................  
.................... void writeReg(int addr, int dado) { 
.................... 	i2c_start(); 
0280:  BSF    F94.4
0282:  MOVLW  1E
0284:  MOVWF  00
0286:  DECFSZ 00,F
0288:  BRA    0286
028A:  BSF    F94.3
028C:  MOVLW  1F
028E:  MOVWF  00
0290:  DECFSZ 00,F
0292:  BRA    0290
0294:  BCF    F8B.4
0296:  BCF    F94.4
0298:  MOVLW  1E
029A:  MOVWF  00
029C:  DECFSZ 00,F
029E:  BRA    029C
02A0:  BCF    F8B.3
02A2:  BCF    F94.3
.................... 	i2c_write(DS1307); 
02A4:  MOVLW  D0
02A6:  MOVWF  1B
02A8:  RCALL  0120
.................... 	i2c_write(addr); 
02AA:  MOVFF  19,1B
02AE:  RCALL  0120
.................... 	i2c_write(dado); 
02B0:  MOVFF  1A,1B
02B4:  RCALL  0120
.................... 	i2c_stop(); 
02B6:  BCF    F94.4
02B8:  NOP   
02BA:  BSF    F94.3
02BC:  BTFSS  F82.3
02BE:  BRA    02BC
02C0:  MOVLW  1E
02C2:  MOVWF  00
02C4:  DECFSZ 00,F
02C6:  BRA    02C4
02C8:  BRA    02CA
02CA:  NOP   
02CC:  BSF    F94.4
02CE:  MOVLW  1E
02D0:  MOVWF  00
02D2:  DECFSZ 00,F
02D4:  BRA    02D2
.................... } 
02D6:  GOTO   02EA (RETURN)
....................  
.................... void pause(void) { 
.................... 	int aux; 
....................  
.................... 	aux = getReg(sec_addr); 
.................... 	if (!bit_test(aux, 7)) 
.................... 		aux |= 0x80; 
.................... 	else 
.................... 		aux &= 0x7F; 
.................... 	writeReg(sec_addr, aux); 
.................... } 
....................  
.................... int toSec(int in) { 
.................... 	int lsb, msb; 
....................  
.................... 	lsb = in & 0x0F; 
*
0412:  MOVF   1D,W
0414:  ANDLW  0F
0416:  MOVWF  1E
.................... 	msb = (in & 0x70) >> 4; 
0418:  MOVF   1D,W
041A:  ANDLW  70
041C:  MOVWF  00
041E:  SWAPF  00,W
0420:  MOVWF  1F
0422:  MOVLW  0F
0424:  ANDWF  1F,F
....................  
.................... 	return 10 * msb + lsb; 
0426:  MOVF   1F,W
0428:  MULLW  0A
042A:  MOVF   FF3,W
042C:  ADDWF  1E,W
042E:  MOVWF  01
.................... } 
0430:  RETURN 0
....................  
.................... int toHour(int in, short *AM_PM, short *formato) { 
.................... 	int msb, lsb; 
....................  
.................... 	*formato = bit_test(in, 6); 
0432:  MOVFF  22,FE9
0436:  MOVFF  23,FEA
043A:  MOVLW  00
043C:  BTFSC  1F.6
043E:  MOVLW  01
0440:  MOVWF  FEF
.................... 	if (*formato) { 
0442:  MOVFF  23,03
0446:  MOVFF  22,FE9
044A:  MOVFF  23,FEA
044E:  MOVF   FEF,F
0450:  BZ    0472
.................... 		msb = (in & 0x10) >> 4; 
0452:  MOVF   1F,W
0454:  ANDLW  10
0456:  MOVWF  00
0458:  SWAPF  00,W
045A:  MOVWF  24
045C:  MOVLW  0F
045E:  ANDWF  24,F
.................... 		*AM_PM = bit_test(in, 5); 
0460:  MOVFF  20,FE9
0464:  MOVFF  21,FEA
0468:  MOVLW  00
046A:  BTFSC  1F.5
046C:  MOVLW  01
046E:  MOVWF  FEF
.................... 	} else { 
0470:  BRA    0480
.................... 		msb = (in & 0x30) >> 4; 
0472:  MOVF   1F,W
0474:  ANDLW  30
0476:  MOVWF  00
0478:  SWAPF  00,W
047A:  MOVWF  24
047C:  MOVLW  0F
047E:  ANDWF  24,F
.................... 	} 
.................... 	lsb = in & 0x0F; 
0480:  MOVF   1F,W
0482:  ANDLW  0F
0484:  MOVWF  25
....................  
.................... 	return 10 * msb + lsb; 
0486:  MOVF   24,W
0488:  MULLW  0A
048A:  MOVF   FF3,W
048C:  ADDWF  25,W
048E:  MOVWF  01
.................... } 
0490:  GOTO   061A (RETURN)
....................  
.................... int toDate(int in) { 
.................... 	int msb, lsb; 
....................  
.................... 	lsb = in & 0x0F; 
*
04B0:  MOVF   1D,W
04B2:  ANDLW  0F
04B4:  MOVWF  1F
.................... 	msb = (in & 0x30) >> 4; 
04B6:  MOVF   1D,W
04B8:  ANDLW  30
04BA:  MOVWF  00
04BC:  SWAPF  00,W
04BE:  MOVWF  1E
04C0:  MOVLW  0F
04C2:  ANDWF  1E,F
....................  
.................... 	return msb * 10 + lsb; 
04C4:  MOVF   1E,W
04C6:  MULLW  0A
04C8:  MOVF   FF3,W
04CA:  ADDWF  1F,W
04CC:  MOVWF  01
.................... } 
04CE:  GOTO   068E (RETURN)
....................  
.................... int toMonth(int in) { 
.................... 	int lsb, msb; 
....................  
.................... 	lsb = in & 0x0F; 
04D2:  MOVF   1D,W
04D4:  ANDLW  0F
04D6:  MOVWF  1E
.................... 	msb = (in & 0x10) >> 4; 
04D8:  MOVF   1D,W
04DA:  ANDLW  10
04DC:  MOVWF  00
04DE:  SWAPF  00,W
04E0:  MOVWF  1F
04E2:  MOVLW  0F
04E4:  ANDWF  1F,F
....................  
.................... 	return msb * 10 + lsb; 
04E6:  MOVF   1F,W
04E8:  MULLW  0A
04EA:  MOVF   FF3,W
04EC:  ADDWF  1E,W
04EE:  MOVWF  01
.................... } 
04F0:  GOTO   06BC (RETURN)
....................  
.................... int toYear(int in) { 
.................... 	int lsb, msb; 
....................  
.................... 	lsb = in & 0x0F; 
04F4:  MOVF   1D,W
04F6:  ANDLW  0F
04F8:  MOVWF  1E
.................... 	msb = (in & 0xF0) >> 4; 
04FA:  MOVF   1D,W
04FC:  ANDLW  F0
04FE:  MOVWF  00
0500:  SWAPF  00,W
0502:  MOVWF  1F
0504:  MOVLW  0F
0506:  ANDWF  1F,F
....................  
.................... 	return msb * 10 + lsb; 
0508:  MOVF   1F,W
050A:  MULLW  0A
050C:  MOVF   FF3,W
050E:  ADDWF  1E,W
0510:  MOVWF  01
.................... } 
0512:  GOTO   06E8 (RETURN)
....................  
.................... int getSec(void) { 
.................... 	return toSec(getReg(sec_addr)); 
.................... } 
....................  
.................... int getMin(void) { 
.................... 	return toSec(getReg(min_addr)); 
.................... } 
....................  
.................... int getHour(short *AM_PM, short *formato) { 
.................... 	return toHour(getReg(hour_addr), *AM_PM, *formato); 
.................... } 
....................  
.................... int getDayOfWeek(void) { 
.................... 	return getReg(day_addr) & 0x07; 
.................... } 
....................  
.................... int getDate(void) { 
.................... 	return getReg(toDate(date_addr)); 
.................... } 
....................  
.................... int getMonth(void) { 
.................... 	return getReg(toMonth(month_addr)); 
.................... } 
....................  
.................... int getYear(void) { 
.................... 	return getReg(toYear(year_addr)); 
.................... } 
....................  
.................... void initDS1307(void) { 
.................... 	int aux; 
....................  
.................... 	writeReg(sec_addr, getReg(sec_addr) & 0x7F); 
*
02DA:  CLRF   18
02DC:  BRA    01F2
02DE:  MOVF   01,W
02E0:  ANDLW  7F
02E2:  MOVWF  18
02E4:  CLRF   19
02E6:  MOVWF  1A
02E8:  BRA    0280
.................... } 
02EA:  GOTO   08B4 (RETURN)
....................  
.................... void getDS1307(struct cal *calendario) { 
.................... 	int aux; 
....................  
.................... 	i2c_start(); 
*
0516:  BSF    F94.4
0518:  MOVLW  1E
051A:  MOVWF  00
051C:  DECFSZ 00,F
051E:  BRA    051C
0520:  BSF    F94.3
0522:  MOVLW  1F
0524:  MOVWF  00
0526:  DECFSZ 00,F
0528:  BRA    0526
052A:  BCF    F8B.4
052C:  BCF    F94.4
052E:  MOVLW  1E
0530:  MOVWF  00
0532:  DECFSZ 00,F
0534:  BRA    0532
0536:  BCF    F8B.3
0538:  BCF    F94.3
.................... 	i2c_write(DS1307); 
053A:  MOVLW  D0
053C:  MOVWF  1B
053E:  RCALL  0120
.................... 	i2c_write(sec_addr); 
0540:  CLRF   1B
0542:  RCALL  0120
.................... 	i2c_start(); 
0544:  BSF    F94.4
0546:  MOVLW  1E
0548:  MOVWF  00
054A:  DECFSZ 00,F
054C:  BRA    054A
054E:  BSF    F94.3
0550:  MOVLW  1F
0552:  MOVWF  00
0554:  DECFSZ 00,F
0556:  BRA    0554
0558:  BTFSS  F82.3
055A:  BRA    0558
055C:  BCF    F8B.4
055E:  BCF    F94.4
0560:  MOVLW  1E
0562:  MOVWF  00
0564:  DECFSZ 00,F
0566:  BRA    0564
0568:  BCF    F8B.3
056A:  BCF    F94.3
.................... 	i2c_write(DS1307 + 1); 
056C:  MOVLW  D1
056E:  MOVWF  1B
0570:  RCALL  0120
.................... 	calendario->segundos = toSec(i2c_read()); 
0572:  MOVLW  01
0574:  ADDWF  17,W
0576:  MOVWF  01
0578:  MOVLW  00
057A:  ADDWFC 18,W
057C:  MOVWF  03
057E:  MOVFF  01,1A
0582:  MOVWF  1B
0584:  MOVLW  01
0586:  MOVWF  00
0588:  RCALL  018C
058A:  MOVFF  01,1C
058E:  MOVFF  01,1D
0592:  RCALL  0412
0594:  MOVFF  1B,FEA
0598:  MOVFF  1A,FE9
059C:  MOVFF  01,FEF
.................... 	calendario->minutos = toSec(i2c_read()); 
05A0:  MOVLW  02
05A2:  ADDWF  17,W
05A4:  MOVWF  01
05A6:  MOVLW  00
05A8:  ADDWFC 18,W
05AA:  MOVWF  03
05AC:  MOVFF  01,1A
05B0:  MOVWF  1B
05B2:  MOVLW  01
05B4:  MOVWF  00
05B6:  RCALL  018C
05B8:  MOVFF  01,1C
05BC:  MOVFF  01,1D
05C0:  RCALL  0412
05C2:  MOVFF  1B,FEA
05C6:  MOVFF  1A,FE9
05CA:  MOVFF  01,FEF
.................... 	calendario->horas = toHour(i2c_read(), calendario->am_pm, calendario->_12h); 
05CE:  MOVLW  03
05D0:  ADDWF  17,W
05D2:  MOVWF  01
05D4:  MOVLW  00
05D6:  ADDWFC 18,W
05D8:  MOVWF  03
05DA:  MOVFF  01,1A
05DE:  MOVWF  1B
05E0:  MOVLW  01
05E2:  MOVWF  00
05E4:  RCALL  018C
05E6:  MOVFF  01,1C
05EA:  MOVFF  17,FE9
05EE:  MOVFF  18,FEA
05F2:  MOVLW  00
05F4:  BTFSC  FEF.0
05F6:  MOVLW  01
05F8:  MOVWF  1D
05FA:  MOVFF  17,FE9
05FE:  MOVFF  18,FEA
0602:  MOVLW  00
0604:  BTFSC  FEF.0
0606:  MOVLW  01
0608:  MOVWF  1E
060A:  MOVFF  01,1F
060E:  CLRF   21
0610:  MOVFF  1D,20
0614:  CLRF   23
0616:  MOVWF  22
0618:  BRA    0432
061A:  MOVFF  1B,FEA
061E:  MOVFF  1A,FE9
0622:  MOVFF  01,FEF
.................... 	calendario->horas = bcdToDec(i2c_read() & 0x63); 
0626:  MOVLW  03
0628:  ADDWF  17,W
062A:  MOVWF  01
062C:  MOVLW  00
062E:  ADDWFC 18,W
0630:  MOVWF  03
0632:  MOVFF  01,1A
0636:  MOVWF  1B
0638:  MOVLW  01
063A:  MOVWF  00
063C:  RCALL  018C
063E:  MOVF   01,W
0640:  ANDLW  63
0642:  MOVWF  1C
0644:  MOVWF  1D
0646:  BRA    0494
0648:  MOVFF  1B,FEA
064C:  MOVFF  1A,FE9
0650:  MOVFF  01,FEF
.................... 	calendario->dow = i2c_read() & 0x07; 
0654:  MOVLW  04
0656:  ADDWF  17,W
0658:  MOVWF  FE9
065A:  MOVLW  00
065C:  ADDWFC 18,W
065E:  MOVWF  FEA
0660:  MOVLW  01
0662:  MOVWF  00
0664:  RCALL  018C
0666:  MOVF   01,W
0668:  ANDLW  07
066A:  MOVWF  FEF
.................... 	calendario->dia = toDate(i2c_read()); 
066C:  MOVLW  05
066E:  ADDWF  17,W
0670:  MOVWF  01
0672:  MOVLW  00
0674:  ADDWFC 18,W
0676:  MOVWF  03
0678:  MOVFF  01,1A
067C:  MOVWF  1B
067E:  MOVLW  01
0680:  MOVWF  00
0682:  RCALL  018C
0684:  MOVFF  01,1C
0688:  MOVFF  01,1D
068C:  BRA    04B0
068E:  MOVFF  1B,FEA
0692:  MOVFF  1A,FE9
0696:  MOVFF  01,FEF
.................... 	calendario->mes = toMonth(i2c_read()); 
069A:  MOVLW  06
069C:  ADDWF  17,W
069E:  MOVWF  01
06A0:  MOVLW  00
06A2:  ADDWFC 18,W
06A4:  MOVWF  03
06A6:  MOVFF  01,1A
06AA:  MOVWF  1B
06AC:  MOVLW  01
06AE:  MOVWF  00
06B0:  RCALL  018C
06B2:  MOVFF  01,1C
06B6:  MOVFF  01,1D
06BA:  BRA    04D2
06BC:  MOVFF  1B,FEA
06C0:  MOVFF  1A,FE9
06C4:  MOVFF  01,FEF
.................... 	calendario->ano = toYear(i2c_read(0)); 
06C8:  MOVLW  07
06CA:  ADDWF  17,W
06CC:  MOVWF  01
06CE:  MOVLW  00
06D0:  ADDWFC 18,W
06D2:  MOVWF  03
06D4:  MOVFF  01,1A
06D8:  MOVWF  1B
06DA:  CLRF   00
06DC:  RCALL  018C
06DE:  MOVFF  01,1C
06E2:  MOVFF  01,1D
06E6:  BRA    04F4
06E8:  MOVFF  1B,FEA
06EC:  MOVFF  1A,FE9
06F0:  MOVFF  01,FEF
.................... 	i2c_stop(); 
06F4:  BCF    F94.4
06F6:  NOP   
06F8:  BSF    F94.3
06FA:  BTFSS  F82.3
06FC:  BRA    06FA
06FE:  MOVLW  1E
0700:  MOVWF  00
0702:  DECFSZ 00,F
0704:  BRA    0702
0706:  BRA    0708
0708:  NOP   
070A:  BSF    F94.4
070C:  MOVLW  1E
070E:  MOVWF  00
0710:  DECFSZ 00,F
0712:  BRA    0710
.................... } 
0714:  GOTO   08D2 (RETURN)
....................  
.................... void setDS1307(int seg, int min, int hor, int dow, int dia, int mes, int ano, 
.................... 		short am_pm) { 
.................... 	i2c_start(); 
.................... 	i2c_write(DS1307); 
.................... 	i2c_write(sec_addr); 
.................... 	i2c_write(seg); 
.................... 	i2c_write(min); 
.................... } 
....................  
.................... #endif /* CALENDARIO_H_ */ 
....................  
.................... #include"lcd_4b.c" 
.................... #define rs PIN_E0 
.................... #define en PIN_E1 
.................... #define d4 PIN_D4 
.................... #define d5 PIN_D5 
.................... #define d6 PIN_D6 
.................... #define d7 PIN_D7 
....................  
.................... void lcd_cmd(int cmd) { 
.................... 	output_bit(d4, bit_test(cmd, 0)); 
*
0316:  BTFSC  24.0
0318:  BRA    031E
031A:  BCF    F8C.4
031C:  BRA    0320
031E:  BSF    F8C.4
0320:  BCF    F95.4
.................... 	output_bit(d5, bit_test(cmd, 1)); 
0322:  BTFSC  24.1
0324:  BRA    032A
0326:  BCF    F8C.5
0328:  BRA    032C
032A:  BSF    F8C.5
032C:  BCF    F95.5
.................... 	output_bit(d6, bit_test(cmd, 2)); 
032E:  BTFSC  24.2
0330:  BRA    0336
0332:  BCF    F8C.6
0334:  BRA    0338
0336:  BSF    F8C.6
0338:  BCF    F95.6
.................... 	output_bit(d7, bit_test(cmd, 3)); 
033A:  BTFSC  24.3
033C:  BRA    0342
033E:  BCF    F8C.7
0340:  BRA    0344
0342:  BSF    F8C.7
0344:  BCF    F95.7
.................... 	output_high(en); 
0346:  BCF    F96.1
0348:  BSF    F8D.1
.................... 	output_low(en); 
034A:  BCF    F96.1
034C:  BCF    F8D.1
.................... } 
034E:  RETURN 0
....................  
.................... void lcd_envia_byte(short endereco, int dado) { 
.................... 	output_low(rs); 
*
0370:  BCF    F96.0
0372:  BCF    F8D.0
.................... 	output_bit(rs, endereco); 
0374:  MOVF   21,F
0376:  BNZ   037C
0378:  BCF    F8D.0
037A:  BRA    037E
037C:  BSF    F8D.0
037E:  BCF    F96.0
.................... 	delay_us(100); 
0380:  MOVLW  64
0382:  MOVWF  23
0384:  BRA    0350
.................... 	output_low(en); 
0386:  BCF    F96.1
0388:  BCF    F8D.1
.................... 	lcd_cmd(dado >> 4); 
038A:  SWAPF  22,W
038C:  MOVWF  23
038E:  MOVLW  0F
0390:  ANDWF  23,F
0392:  MOVFF  23,24
0396:  RCALL  0316
.................... 	lcd_cmd(dado & 0x0f); 
0398:  MOVF   22,W
039A:  ANDLW  0F
039C:  MOVWF  23
039E:  MOVWF  24
03A0:  RCALL  0316
.................... 	delay_ms(1); 
03A2:  MOVLW  01
03A4:  MOVWF  23
03A6:  RCALL  02EE
.................... } 
03A8:  RETURN 0
....................  
.................... void lcd_pos_xy(int x, int y) { 
.................... 	int endereco; 
.................... 	if (y != 1) 
*
0718:  DECFSZ 1F,W
071A:  BRA    071E
071C:  BRA    0724
.................... 		endereco = 0xc0; 
071E:  MOVLW  C0
0720:  MOVWF  20
.................... 	else 
0722:  BRA    0728
.................... 		endereco = 0x80; 
0724:  MOVLW  80
0726:  MOVWF  20
.................... 	endereco += x - 1; 
0728:  MOVLW  01
072A:  SUBWF  1E,W
072C:  ADDWF  20,F
.................... 	lcd_envia_byte(0, endereco); 
072E:  CLRF   21
0730:  MOVFF  20,22
0734:  RCALL  0370
.................... } 
0736:  GOTO   077E (RETURN)
....................  
.................... void lcd(char c) { 
.................... 	switch (c) { 
073A:  MOVF   1D,W
073C:  XORLW  0C
073E:  BZ    074E
0740:  XORLW  06
0742:  BZ    075E
0744:  XORLW  07
0746:  BZ    075E
0748:  XORLW  05
074A:  BZ    076A
074C:  BRA    0774
.................... 	case '\f': 
.................... 		lcd_envia_byte(0, 1);     // 0,1 
074E:  CLRF   21
0750:  MOVLW  01
0752:  MOVWF  22
0754:  RCALL  0370
.................... 		delay_ms(2); 
0756:  MOVLW  02
0758:  MOVWF  23
075A:  RCALL  02EE
.................... 		break; 
075C:  BRA    077E
.................... 	case '\n': 
.................... 	case '\r': 
.................... 		lcd_pos_xy(1, 2);      // 1,2  COLUNA,LINHA 
075E:  MOVLW  01
0760:  MOVWF  1E
0762:  MOVLW  02
0764:  MOVWF  1F
0766:  BRA    0718
.................... 		break; 
0768:  BRA    077E
.................... 	case '\b': 
.................... 		lcd_envia_byte(0, 0x10); 
076A:  CLRF   21
076C:  MOVLW  10
076E:  MOVWF  22
0770:  RCALL  0370
.................... 		break; 
0772:  BRA    077E
.................... 	default: 
.................... 		lcd_envia_byte(1, c); 
0774:  MOVLW  01
0776:  MOVWF  21
0778:  MOVFF  1D,22
077C:  RCALL  0370
.................... 		break; 
.................... 	} 
.................... } 
077E:  RETURN 0
....................  
.................... void lcd_init() { 
....................  
.................... 	int conta; 
....................  
.................... 	output_low(rs); 
*
03AA:  BCF    F96.0
03AC:  BCF    F8D.0
.................... 	output_low(en); 
03AE:  BCF    F96.1
03B0:  BCF    F8D.1
.................... 	output_low(d4); 
03B2:  BCF    F95.4
03B4:  BCF    F8C.4
.................... 	output_low(d5); 
03B6:  BCF    F95.5
03B8:  BCF    F8C.5
.................... 	output_low(d6); 
03BA:  BCF    F95.6
03BC:  BCF    F8C.6
.................... 	output_low(d7); 
03BE:  BCF    F95.7
03C0:  BCF    F8C.7
....................  
.................... 	delay_ms(15); 
03C2:  MOVLW  0F
03C4:  MOVWF  23
03C6:  RCALL  02EE
....................  
.................... 	for (conta = 1; conta <= 3; conta++) { 
03C8:  MOVLW  01
03CA:  MOVWF  17
03CC:  MOVF   17,W
03CE:  SUBLW  03
03D0:  BNC   03E2
.................... 		lcd_cmd(0x03); 
03D2:  MOVLW  03
03D4:  MOVWF  24
03D6:  RCALL  0316
.................... 		delay_ms(5); 
03D8:  MOVLW  05
03DA:  MOVWF  23
03DC:  RCALL  02EE
.................... 	} 
03DE:  INCF   17,F
03E0:  BRA    03CC
.................... 	lcd_cmd(0x02);           //escreve comando para interface de 4 vias de dados 
03E2:  MOVLW  02
03E4:  MOVWF  24
03E6:  RCALL  0316
.................... 	lcd_envia_byte(0, 0x28); //escreve comando informando lcd de 2 linhas (5x7) em 4bits 
03E8:  CLRF   21
03EA:  MOVLW  28
03EC:  MOVWF  22
03EE:  RCALL  0370
.................... 	lcd_envia_byte(0, 0x0c); //escreve comando para limpar todo o display 
03F0:  CLRF   21
03F2:  MOVLW  0C
03F4:  MOVWF  22
03F6:  RCALL  0370
.................... 	lcd_envia_byte(0, 0x01); //escreve comando para ligar o display **com cursor piscante 
03F8:  CLRF   21
03FA:  MOVLW  01
03FC:  MOVWF  22
03FE:  RCALL  0370
.................... 	lcd_envia_byte(0, 0x06); //escreve comando para incrementar automaticamente á direita 
0400:  CLRF   21
0402:  MOVLW  06
0404:  MOVWF  22
0406:  RCALL  0370
.................... 	delay_ms(5); 
0408:  MOVLW  05
040A:  MOVWF  23
040C:  RCALL  02EE
.................... } 
040E:  GOTO   08B6 (RETURN)
....................  
....................  
....................  
.................... struct cal calendario; 
....................  
.................... int main(void) { 
*
0896:  CLRF   FF8
0898:  BCF    FD0.7
089A:  CLRF   FEA
089C:  CLRF   FE9
089E:  MOVLW  40
08A0:  MOVWF  FAF
08A2:  MOVLW  A2
08A4:  MOVWF  FAC
08A6:  MOVLW  90
08A8:  MOVWF  FAB
08AA:  BSF    FC1.0
08AC:  BSF    FC1.1
08AE:  BSF    FC1.2
08B0:  BCF    FC1.3
....................  
.................... 	int formato[4], AM_PM[3], diaSemana[4]; 
....................  
.................... 	initDS1307(); 
08B2:  BRA    02DA
.................... 	lcd_init(); 
08B4:  BRA    03AA
.................... 	delay_ms(100); 
08B6:  MOVLW  64
08B8:  MOVWF  23
08BA:  RCALL  02EE
....................  
.................... 	while (TRUE) { 
....................  
.................... 		delay_ms(500); 
08BC:  MOVLW  02
08BE:  MOVWF  17
08C0:  MOVLW  FA
08C2:  MOVWF  23
08C4:  RCALL  02EE
08C6:  DECFSZ 17,F
08C8:  BRA    08C0
.................... 		getDS1307(&calendario); 
08CA:  CLRF   18
08CC:  MOVLW  04
08CE:  MOVWF  17
08D0:  BRA    0516
....................  
.................... 		if (calendario._12h) { 
08D2:  BTFSS  04.1
08D4:  BRA    0926
.................... 			strcpy(formato, "12h"); 
08D6:  CLRF   FEA
08D8:  MOVLW  0C
08DA:  MOVWF  FE9
08DC:  MOVLW  00
08DE:  CALL   0004
08E2:  TBLRD*-
08E4:  TBLRD*+
08E6:  MOVF   FF5,W
08E8:  MOVWF  FEE
08EA:  IORLW  00
08EC:  BNZ   08E4
.................... 			if (calendario.am_pm) 
08EE:  BTFSS  04.0
08F0:  BRA    090C
.................... 				strcpy(AM_PM, "AM"); 
08F2:  CLRF   FEA
08F4:  MOVLW  10
08F6:  MOVWF  FE9
08F8:  MOVLW  00
08FA:  CALL   0018
08FE:  TBLRD*-
0900:  TBLRD*+
0902:  MOVF   FF5,W
0904:  MOVWF  FEE
0906:  IORLW  00
0908:  BNZ   0900
.................... 			else 
090A:  BRA    0924
.................... 				strcpy(AM_PM, "PM"); 
090C:  CLRF   FEA
090E:  MOVLW  10
0910:  MOVWF  FE9
0912:  MOVLW  00
0914:  CALL   002C
0918:  TBLRD*-
091A:  TBLRD*+
091C:  MOVF   FF5,W
091E:  MOVWF  FEE
0920:  IORLW  00
0922:  BNZ   091A
.................... 		} else { 
0924:  BRA    0956
.................... 			strcpy(formato, "24h"); 
0926:  CLRF   FEA
0928:  MOVLW  0C
092A:  MOVWF  FE9
092C:  MOVLW  00
092E:  CALL   0040
0932:  TBLRD*-
0934:  TBLRD*+
0936:  MOVF   FF5,W
0938:  MOVWF  FEE
093A:  IORLW  00
093C:  BNZ   0934
.................... 			strcpy(AM_PM, "  "); 
093E:  CLRF   FEA
0940:  MOVLW  10
0942:  MOVWF  FE9
0944:  MOVLW  00
0946:  CALL   0054
094A:  TBLRD*-
094C:  TBLRD*+
094E:  MOVF   FF5,W
0950:  MOVWF  FEE
0952:  IORLW  00
0954:  BNZ   094C
.................... 		} 
.................... 		AM_PM[2] = '\0'; 
0956:  CLRF   12
.................... 		formato[3] = '\0'; 
0958:  CLRF   0F
....................  
.................... 		switch (calendario.dow - 1) { 
095A:  MOVLW  01
095C:  SUBWF  08,W
095E:  BZ    097A
0960:  XORLW  01
0962:  BZ    0994
0964:  XORLW  03
0966:  BZ    09AE
0968:  XORLW  01
096A:  BZ    09C8
096C:  XORLW  07
096E:  BZ    09E2
0970:  XORLW  01
0972:  BZ    09FC
0974:  XORLW  03
0976:  BZ    0A16
0978:  BRA    0A30
.................... 		case dom: 
.................... 			strcpy(diaSemana, "DOM"); 
097A:  CLRF   FEA
097C:  MOVLW  13
097E:  MOVWF  FE9
0980:  MOVLW  00
0982:  CALL   0068
0986:  TBLRD*-
0988:  TBLRD*+
098A:  MOVF   FF5,W
098C:  MOVWF  FEE
098E:  IORLW  00
0990:  BNZ   0988
.................... 			break; 
0992:  BRA    0A48
.................... 		case seg: 
.................... 			strcpy(diaSemana, "SEG"); 
0994:  CLRF   FEA
0996:  MOVLW  13
0998:  MOVWF  FE9
099A:  MOVLW  00
099C:  CALL   007C
09A0:  TBLRD*-
09A2:  TBLRD*+
09A4:  MOVF   FF5,W
09A6:  MOVWF  FEE
09A8:  IORLW  00
09AA:  BNZ   09A2
.................... 			break; 
09AC:  BRA    0A48
.................... 		case ter: 
.................... 			strcpy(diaSemana, "TER"); 
09AE:  CLRF   FEA
09B0:  MOVLW  13
09B2:  MOVWF  FE9
09B4:  MOVLW  00
09B6:  CALL   0090
09BA:  TBLRD*-
09BC:  TBLRD*+
09BE:  MOVF   FF5,W
09C0:  MOVWF  FEE
09C2:  IORLW  00
09C4:  BNZ   09BC
.................... 			break; 
09C6:  BRA    0A48
.................... 		case qua: 
.................... 			strcpy(diaSemana, "QUA"); 
09C8:  CLRF   FEA
09CA:  MOVLW  13
09CC:  MOVWF  FE9
09CE:  MOVLW  00
09D0:  CALL   00A4
09D4:  TBLRD*-
09D6:  TBLRD*+
09D8:  MOVF   FF5,W
09DA:  MOVWF  FEE
09DC:  IORLW  00
09DE:  BNZ   09D6
.................... 			break; 
09E0:  BRA    0A48
.................... 		case qui: 
.................... 			strcpy(diaSemana, "QUI"); 
09E2:  CLRF   FEA
09E4:  MOVLW  13
09E6:  MOVWF  FE9
09E8:  MOVLW  00
09EA:  CALL   00B8
09EE:  TBLRD*-
09F0:  TBLRD*+
09F2:  MOVF   FF5,W
09F4:  MOVWF  FEE
09F6:  IORLW  00
09F8:  BNZ   09F0
.................... 			break; 
09FA:  BRA    0A48
.................... 		case sex: 
.................... 			strcpy(diaSemana, "SEX"); 
09FC:  CLRF   FEA
09FE:  MOVLW  13
0A00:  MOVWF  FE9
0A02:  MOVLW  00
0A04:  CALL   00CC
0A08:  TBLRD*-
0A0A:  TBLRD*+
0A0C:  MOVF   FF5,W
0A0E:  MOVWF  FEE
0A10:  IORLW  00
0A12:  BNZ   0A0A
.................... 			break; 
0A14:  BRA    0A48
.................... 		case sab: 
.................... 			strcpy(diaSemana, "SAB"); 
0A16:  CLRF   FEA
0A18:  MOVLW  13
0A1A:  MOVWF  FE9
0A1C:  MOVLW  00
0A1E:  CALL   00E0
0A22:  TBLRD*-
0A24:  TBLRD*+
0A26:  MOVF   FF5,W
0A28:  MOVWF  FEE
0A2A:  IORLW  00
0A2C:  BNZ   0A24
.................... 			break; 
0A2E:  BRA    0A48
.................... 		default: 
.................... 			strcpy(diaSemana, "ERR"); 
0A30:  CLRF   FEA
0A32:  MOVLW  13
0A34:  MOVWF  FE9
0A36:  MOVLW  00
0A38:  CALL   00F4
0A3C:  TBLRD*-
0A3E:  TBLRD*+
0A40:  MOVF   FF5,W
0A42:  MOVWF  FEE
0A44:  IORLW  00
0A46:  BNZ   0A3E
.................... 			break; 
.................... 		} 
.................... 		diaSemana[3] = '\0'; 
0A48:  CLRF   16
....................  
.................... 		printf(lcd, "\f%s %s  %02d:%02d:%02d", formato, AM_PM, calendario.horas, 
.................... 				calendario.minutos, calendario.segundos); 
0A4A:  MOVLW  0C
0A4C:  MOVWF  1D
0A4E:  RCALL  073A
0A50:  CLRF   FEA
0A52:  MOVLW  0C
0A54:  MOVWF  FE9
0A56:  RCALL  0780
0A58:  MOVLW  20
0A5A:  MOVWF  1D
0A5C:  RCALL  073A
0A5E:  CLRF   FEA
0A60:  MOVLW  10
0A62:  MOVWF  FE9
0A64:  RCALL  0780
0A66:  MOVLW  20
0A68:  MOVWF  1D
0A6A:  RCALL  073A
0A6C:  MOVLW  20
0A6E:  MOVWF  1D
0A70:  RCALL  073A
0A72:  MOVFF  07,17
0A76:  MOVLW  01
0A78:  MOVWF  18
0A7A:  RCALL  07CC
0A7C:  MOVLW  3A
0A7E:  MOVWF  1D
0A80:  RCALL  073A
0A82:  MOVFF  06,17
0A86:  MOVLW  01
0A88:  MOVWF  18
0A8A:  RCALL  07CC
0A8C:  MOVLW  3A
0A8E:  MOVWF  1D
0A90:  RCALL  073A
0A92:  MOVFF  05,17
0A96:  MOVLW  01
0A98:  MOVWF  18
0A9A:  RCALL  07CC
.................... 		printf(lcd, "\n%s     %02d/%02d/%02d", diaSemana, calendario.dia, 
.................... 				calendario.mes, calendario.ano); 
0A9C:  MOVLW  0A
0A9E:  MOVWF  1D
0AA0:  RCALL  073A
0AA2:  CLRF   FEA
0AA4:  MOVLW  13
0AA6:  MOVWF  FE9
0AA8:  RCALL  0780
0AAA:  MOVLW  0B
0AAC:  MOVWF  FF6
0AAE:  MOVLW  01
0AB0:  MOVWF  FF7
0AB2:  MOVLW  05
0AB4:  MOVWF  17
0AB6:  BRA    0876
0AB8:  MOVFF  09,17
0ABC:  MOVLW  01
0ABE:  MOVWF  18
0AC0:  RCALL  07CC
0AC2:  MOVLW  2F
0AC4:  MOVWF  1D
0AC6:  RCALL  073A
0AC8:  MOVFF  0A,17
0ACC:  MOVLW  01
0ACE:  MOVWF  18
0AD0:  RCALL  07CC
0AD2:  MOVLW  2F
0AD4:  MOVWF  1D
0AD6:  RCALL  073A
0AD8:  MOVFF  0B,17
0ADC:  MOVLW  01
0ADE:  MOVWF  18
0AE0:  RCALL  07CC
.................... 	} 
0AE2:  BRA    08BC
.................... } 
0AE4:  SLEEP 

Configuration Fuses:
   Word  1: 2600   H4 NOOSCSEN
   Word  2: 0E0E   PUT BROWNOUT BORV20 NOWDT WDT128
   Word  3: 0100   CCP2C1
   Word  4: 0081   STVREN NOLVP NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
